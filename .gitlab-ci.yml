include:
- template: Security/SAST.gitlab-ci.yml
- project: 'devops-templates/general-templates'
  ref: 'development'
  file:
    - static-code-analysis/sonar-java.yml

variables:
  GRADLE_OPTS: "-Dorg.gradle.daemon=false"

stages:
  - codequality
  - security_tests
  - test

sast:
  stage: security_tests
  tags:
    - gitlab-runner-docker
  artifacts:
    reports:
      sast: gl-sast-report.json
    paths: [gl-sast-report.json]

test-automation:
  stage: test
  image: jhonacevedor/quipux-test-automation # Utiliza la imagen oficial de Gradle con la versión "latest"
  before_script:
    - grep -rl 'USER_GA' ./ | xargs sed -i 's/USER_GA/'"$USER_GA"'/g'
    - grep -rl 'PASSWORD_GA' ./ | xargs sed -i 's/PASSWORD_GA/'"$PASSWORD_GA"'/g'
  script:
    - gradle clean test -Dproperties=serenity.conf aggregate
  tags:
    - gitlab-runner-docker
  artifacts: # Define la sección de artefactos
    paths:
      - target/ # Ruta del archivo de reporte